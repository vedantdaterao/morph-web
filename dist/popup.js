const C=document.getElementById("masterToggle"),T=document.getElementById("masterLabelText");chrome.storage.sync.get({enabled:!0},({enabled:e})=>{C.checked=e,T.textContent=e?"Extension Enabled":"Extension Disabled"});C.addEventListener("change",()=>{const e=C.checked;T.textContent=e?"Extension Enabled":"Extension Disabled",chrome.storage.sync.set({enabled:e}),chrome.tabs.query({active:!0,currentWindow:!0},([n])=>{n?.id&&chrome.tabs.sendMessage(n.id,{type:"toggleExtension",enabled:e})})});document.querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{const n=e.getAttribute("data-tab");document.querySelectorAll(".tab").forEach(o=>o.classList.remove("active")),e.classList.add("active"),document.querySelectorAll(".tab-content").forEach(o=>{o.classList.toggle("active",o.id===n)})})});const L=document.getElementById("selectorInput"),O=document.getElementById("hideButton"),S=document.getElementById("selectorList");async function b(){const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});return new URL(e.url).hostname}async function w(){const e=await b(),o=(await chrome.storage.sync.get(e))[e]?.selectors||[];S.innerHTML="",o.forEach(t=>{const l=document.createElement("li"),i=document.createElement("button");i.textContent="-",i.style="margin-right: 8px; align-item: center; aspect-ratio: 1 / 1; height: 21px; padding: 0",i.addEventListener("click",async()=>{await F(t),await w();const[d]=await chrome.tabs.query({active:!0,currentWindow:!0});d?.id&&chrome.tabs.sendMessage(d.id,{type:"refreshSelectors"})}),l.appendChild(i);const c=document.createElement("pre");c.textContent=t,l.appendChild(c),l.style="display: flex; align-items: center;",S.appendChild(l)})}async function W(e){const n=await b(),t=(await chrome.storage.sync.get(n))[n]?.selectors||[];t.includes(e)||(t.push(e),await chrome.storage.sync.set({[n]:{selectors:t}}))}async function F(e){const n=await b(),l=((await chrome.storage.sync.get(n))[n]?.selectors||[]).filter(i=>i!==e);await chrome.storage.sync.set({[n]:{selectors:l}})}O.addEventListener("click",async()=>{const e=L.value.trim();if(!e)return;await W(e),await w(),L.value="";const[n]=await chrome.tabs.query({active:!0,currentWindow:!0});n?.id&&chrome.tabs.sendMessage(n.id,{type:"refreshSelectors"})});w();async function H(){return(await chrome.tabs.query({active:!0,currentWindow:!0}))[0]?.url??null}function p(e,n){const o=document.createElement("div"),t=document.createElement("label");return t.textContent=e,o.appendChild(t),o.appendChild(n),o}async function A(){const e=document.getElementById("cookieList");e.innerHTML="";const n=await H();if(!n){e.innerHTML="<li>Cannot get current tab URL</li>";return}chrome.cookies.getAll({url:n},o=>{if(!o||o.length===0){e.innerHTML="<li>No cookies found for this page</li>";return}o.forEach(t=>{const l=document.createElement("li");l.addEventListener("click",s=>{s.target===l&&l.classList.toggle("expanded")});const i=document.createElement("div");i.textContent="âŒ„  "+t.name,l.appendChild(i);const c=document.createElement("div");c.addEventListener("click",s=>s.stopPropagation()),c.className="editor";const d=document.createElement("textarea");d.value=t.value,d.placeholder="Value",d.rows=3;const I=p("Value",d),m=document.createElement("input");m.value=t.path;const q=p("Path",m),u=document.createElement("input");if(t.expirationDate){const s=new Date(t.expirationDate*1e3);u.type="datetime-local",u.value=s.toISOString().slice(0,16)}else u.type="text",u.placeholder="Session cookie";const B=p("Expiration",u),g=document.createElement("select");["true","false"].forEach(s=>{const r=document.createElement("option");r.value=s,r.textContent=s,(t.secure&&s==="true"||!t.secure&&s==="false")&&(r.selected=!0),g.appendChild(r)});const D=p("Secure",g),y=document.createElement("select");["true","false"].forEach(s=>{const r=document.createElement("option");r.value=s,r.textContent=s,(t.httpOnly&&s==="true"||!t.httpOnly&&s==="false")&&(r.selected=!0),y.appendChild(r)});const M=p("HttpOnly",y),E=document.createElement("button");E.textContent="Save",E.addEventListener("click",s=>{s.stopPropagation();const r=t.secure?"https://":"http://",v=t.domain.startsWith(".")?t.domain.slice(1):t.domain,x=r+v+m.value;let f;u.value&&(f=Math.floor(new Date(u.value).getTime()/1e3)),chrome.cookies.set({url:x,name:t.name,value:d.value,domain:t.domain,path:m.value,secure:g.value==="true",httpOnly:y.value==="true",expirationDate:f},()=>{let a=c.querySelector(".save-message");a||(a=document.createElement("div"),a.className="save-message",a.style.color="green",a.style.fontSize="12px",a.style.marginTop="4px",a.style.marginRight="4px",c.appendChild(a)),a.textContent="Cookie updated!",setTimeout(()=>{a.textContent=""},2e3)})});const h=document.createElement("button");h.textContent="Delete",h.style.marginLeft="6px",h.addEventListener("click",s=>{s.stopPropagation();const r=t.secure?"https://":"http://",v=t.domain.startsWith(".")?t.domain.slice(1):t.domain,x=r+v+m.value;chrome.cookies.remove({url:x,name:t.name},f=>{let a=c.querySelector(".save-message");a||(a=document.createElement("div"),a.className="save-message",a.style.color="red",a.style.fontSize="12px",a.style.marginTop="4px",c.appendChild(a)),a.textContent="Cookie deleted!",setTimeout(()=>{a.textContent=""},2e3),l.remove()})}),c.appendChild(I),c.appendChild(q),c.appendChild(B),c.appendChild(D),c.appendChild(M),c.appendChild(E),c.appendChild(h),l.appendChild(c),l.addEventListener("click",()=>l.classList.toggle("expanded")),e.appendChild(l)})})}A();
