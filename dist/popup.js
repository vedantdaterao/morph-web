const L=document.getElementById("masterToggle"),k=document.getElementById("masterLabelText");chrome.storage.sync.get({enabled:!0},({enabled:t})=>{L.checked=t,k.textContent=t?"Extension Enabled":"Extension Disabled"});L.addEventListener("change",()=>{const t=L.checked;k.textContent=t?"Extension Enabled":"Extension Disabled",chrome.storage.sync.set({enabled:t}),chrome.tabs.query({active:!0,currentWindow:!0},([n])=>{n?.id&&chrome.tabs.sendMessage(n.id,{type:"toggleExtension",enabled:t})})});document.querySelectorAll(".tab").forEach(t=>{t.addEventListener("click",()=>{const n=t.getAttribute("data-tab");document.querySelectorAll(".tab").forEach(l=>l.classList.remove("active")),t.classList.add("active"),document.querySelectorAll(".tab-content").forEach(l=>{l.classList.toggle("active",l.id===n)})})});const I=document.getElementById("selectorInput"),H=document.getElementById("hideButton"),B=document.getElementById("selectorList");async function S(){const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});return new URL(t.url).hostname}async function T(){const t=await S(),l=(await chrome.storage.sync.get(t))[t]?.selectors||[];B.innerHTML="",l.forEach(e=>{const o=document.createElement("li"),r=document.createElement("button");r.textContent="-",r.style="margin-right: 8px; align-item: center; aspect-ratio: 1 / 1; height: 21px; padding: 0",r.addEventListener("click",async()=>{await O(e),await T();const[i]=await chrome.tabs.query({active:!0,currentWindow:!0});i?.id&&chrome.tabs.sendMessage(i.id,{type:"refreshSelectors"})}),o.appendChild(r);const a=document.createElement("pre");a.textContent=e,o.appendChild(a),o.style="display: flex; align-items: center;",B.appendChild(o)})}async function N(t){const n=await S(),e=(await chrome.storage.sync.get(n))[n]?.selectors||[];e.includes(t)||(e.push(t),await chrome.storage.sync.set({[n]:{selectors:e}}))}async function O(t){const n=await S(),o=((await chrome.storage.sync.get(n))[n]?.selectors||[]).filter(r=>r!==t);await chrome.storage.sync.set({[n]:{selectors:o}})}H.addEventListener("click",async()=>{const t=I.value.trim();if(!t)return;await N(t),await T(),I.value="";const[n]=await chrome.tabs.query({active:!0,currentWindow:!0});n?.id&&chrome.tabs.sendMessage(n.id,{type:"refreshSelectors"})});T();async function q(){return(await chrome.tabs.query({active:!0,currentWindow:!0}))[0]?.url??null}function p(t,n){const l=document.createElement("div"),e=document.createElement("label");return e.textContent=t,l.appendChild(e),l.appendChild(n),l}async function M(){const t=document.getElementById("cookieList");t.innerHTML="";const n=await q();if(!n){t.innerHTML="<li>Cannot get current tab URL</li>";return}chrome.cookies.getAll({url:n},l=>{if(!l||l.length===0){t.innerHTML="<li>No cookies found for this page</li>";return}l.forEach(e=>{const o=document.createElement("li");o.addEventListener("click",c=>{c.target===o&&o.classList.toggle("expanded")});const r=document.createElement("div");r.textContent="âŒ„  "+e.name,o.appendChild(r);const a=document.createElement("div");a.addEventListener("click",c=>c.stopPropagation()),a.className="editor";const i=document.createElement("textarea");i.value=e.value,i.placeholder="Value",i.rows=3;const h=p("Value",i),u=document.createElement("input");u.value=e.path;const y=p("Path",u),m=document.createElement("input");if(e.expirationDate){const c=new Date(e.expirationDate*1e3);m.type="datetime-local",m.value=c.toISOString().slice(0,16)}else m.type="text",m.placeholder="Session cookie";const v=p("Expiration",m),g=document.createElement("select");["true","false"].forEach(c=>{const d=document.createElement("option");d.value=c,d.textContent=c,(e.secure&&c==="true"||!e.secure&&c==="false")&&(d.selected=!0),g.appendChild(d)});const D=p("Secure",g),C=document.createElement("select");["true","false"].forEach(c=>{const d=document.createElement("option");d.value=c,d.textContent=c,(e.httpOnly&&c==="true"||!e.httpOnly&&c==="false")&&(d.selected=!0),C.appendChild(d)});const F=p("HttpOnly",C),x=document.createElement("button");x.textContent="Save",x.addEventListener("click",c=>{c.stopPropagation();const d=e.secure?"https://":"http://",f=e.domain.startsWith(".")?e.domain.slice(1):e.domain,b=d+f+u.value;let w;m.value&&(w=Math.floor(new Date(m.value).getTime()/1e3)),chrome.cookies.set({url:b,name:e.name,value:i.value,domain:e.domain,path:u.value,secure:g.value==="true",httpOnly:C.value==="true",expirationDate:w},()=>{let s=a.querySelector(".save-message");s||(s=document.createElement("div"),s.className="save-message",s.style.color="green",s.style.fontSize="12px",s.style.marginTop="4px",s.style.marginRight="4px",a.appendChild(s)),s.textContent="Cookie updated!",setTimeout(()=>{s.textContent=""},2e3)})});const E=document.createElement("button");E.textContent="Delete",E.style.marginLeft="6px",E.addEventListener("click",c=>{c.stopPropagation();const d=e.secure?"https://":"http://",f=e.domain.startsWith(".")?e.domain.slice(1):e.domain,b=d+f+u.value;chrome.cookies.remove({url:b,name:e.name},w=>{let s=a.querySelector(".save-message");s||(s=document.createElement("div"),s.className="save-message",s.style.color="red",s.style.fontSize="12px",s.style.marginTop="4px",a.appendChild(s)),s.textContent="Cookie deleted!",setTimeout(()=>{s.textContent=""},2e3),o.remove()})}),a.appendChild(h),a.appendChild(y),a.appendChild(v),a.appendChild(D),a.appendChild(F),a.appendChild(x),a.appendChild(E),o.appendChild(a),o.addEventListener("click",()=>o.classList.toggle("expanded")),t.appendChild(o)})})}M();async function W(){const t=await q();if(!t)return;const n=document.getElementById("addCookieForm"),l=document.getElementById("addCookie");let e=document.querySelector(".save-message");if(e||(e=document.createElement("div"),e.className="save-message",l.insertAdjacentElement("afterend",e)),n.innerHTML="",n.dataset.open==="true"){n.dataset.open="false",n.style.display="none";return}n.dataset.open="true",n.style.display="block";const o=document.createElement("input");o.placeholder="Name";const r=document.createElement("textarea");r.placeholder="Value",r.rows=3,r.style.width="100%";const a=document.createElement("input");a.placeholder="Path",a.value="/";const i=document.createElement("button");i.textContent="Save",i.style.marginRight="6px";const h=document.createElement("button");h.textContent="Cancel";const u=document.createElement("div");u.appendChild(p("Name",o)),u.appendChild(p("Value",r)),u.appendChild(p("Path",a)),u.appendChild(i),u.appendChild(h),n.appendChild(u),o.focus(),h.onclick=()=>{n.innerHTML="",n.dataset.open="false",n.style.display="none"},i.onclick=async()=>{const y=o.value.trim(),m=r.value.trim(),v=a.value.trim()||"/";if(!y){e.style.color="red",e.textContent="enter cookie name",setTimeout(()=>e.textContent="",2e3);return}try{await chrome.cookies.set({url:t,name:y,value:m,path:v},()=>{e.style.color="green",e.textContent="Cookie added!",setTimeout(()=>e.textContent="",2e3)}),await M(),h.click()}catch(g){e.style.color="red",e.textContent="Failed to add cookie",console.error(g),setTimeout(()=>e.textContent="",2e3)}}}document.getElementById("addCookie")?.addEventListener("click",W);
